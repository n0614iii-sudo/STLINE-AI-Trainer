# 📸 写真撮影ガイドライン & 画像可視化機能

## ✅ 実装完了

写真撮影のガイドラインと画像診断結果の可視化機能を追加しました！

## 📸 写真撮影のガイドライン

### ✅ 適切な解析のための条件

姿勢診断ページに、適切な写真を撮影するためのガイドラインを追加しました：

1. **全身が写る**: 頭から足まで全体が写っていること
2. **正面から撮影**: 体の正面がカメラに向いていること
3. **明るい環境**: 十分な照明があること（暗いと検出精度が低下）
4. **シンプルな背景**: 背景が単色またはシンプルなこと
5. **体の輪郭が見える**: 体の輪郭がはっきり見える服装
6. **両腕が見える**: 両腕が体の横に自然に下がっていること
7. **両足が見える**: 両足が完全に見えること
8. **動きがない**: 静止した状態で撮影すること

### ⚠️ 避けるべき条件

- 横や後ろから撮影した写真
- 体の一部が切れている写真
- 暗すぎる、または逆光の写真
- 複雑な背景（模様や他の人が写っている）
- 動いている状態の写真
- 体が大きく傾いている写真

## 🎨 画像可視化機能

### 実装内容

画像診断時に、以下の要素を画像に描画します：

1. **キーポイント**
   - 17個のキーポイントを色分けして表示
   - 信頼度が低いキーポイントは非表示

2. **骨格構造**
   - キーポイント間を線で接続
   - 体の骨格構造を可視化

3. **アライメント線**
   - **肩の水平線**: 左右の肩の高さを評価
   - **骨盤の水平線**: 左右の骨盤の高さを評価
   - **背骨の垂直線**: 背骨の整列を評価
   - **頭部の位置**: 頭部と肩の中心の関係

4. **評価項目の表示**
   - 総合スコア（右上の円形バッジ）
   - 各アライメントスコア（下部パネル）
   - 検出された問題点（右側パネル）

### 色の意味

- **緑**: 良好なアライメント（スコア80%以上）
- **オレンジ**: やや問題のあるアライメント（スコア60-79%）
- **赤**: 問題のあるアライメント（スコア60%未満）

### キーポイントの色

- **頭部（黄色）**: 鼻、目、耳
- **肩（緑）**: 左右の肩
- **肘（マゼンタ）**: 左右の肘
- **手首（シアン）**: 左右の手首
- **骨盤（青）**: 左右の骨盤
- **膝（オレンジ）**: 左右の膝
- **足首（紫）**: 左右の足首

## 🖼️ 可視化画像の表示

### 機能

1. **自動表示**
   - 画像診断完了後、可視化された画像が自動的に表示されます

2. **ダウンロード**
   - 「画像をダウンロード」ボタンで可視化画像を保存できます

3. **見方の説明**
   - 画像の下に、色の意味と見方を表示

## 📊 表示される情報

### 下部パネル

- **総合スコア**: 0-100点
- **整列スコア**:
  - Shoulder（肩）
  - Hip（骨盤）
  - Head（頭部）
  - Spine（背骨）
  - Knee（膝）

### 右側パネル

- **検出された問題**: 最大3件を表示
- 深刻度に応じた色分け

### 右上

- **総合スコアバッジ**: 円形のバッジで表示

## 🔧 技術詳細

### 実装モジュール

- `posture_visualizer.py`: 姿勢可視化クラス
- OpenCVを使用した画像描画
- キーポイント、骨格、アライメント線の描画

### 描画要素

1. **骨格**: `SKELETON_CONNECTIONS`で定義された接続
2. **キーポイント**: 円形マーカー
3. **アライメント線**: 水平線・垂直線
4. **テキスト**: 評価項目とスコア

## 🚀 使用方法

1. **姿勢診断ページにアクセス**
   - ユーザーを選択
   - 姿勢診断ページを開く

2. **写真撮影ガイドラインを確認**
   - 適切な条件を確認
   - 避けるべき条件を確認

3. **写真を撮影**
   - ガイドラインに従って写真を撮影

4. **画像をアップロード**
   - ドラッグ&ドロップまたはファイル選択

5. **結果を確認**
   - 可視化された画像が表示されます
   - 評価項目とスコアを確認
   - 必要に応じて画像をダウンロード

## 📝 注意事項

- 可視化画像は元の画像と同じディレクトリに保存されます
- ファイル名は `analyzed_` で始まります
- 画像は自動的に削除されません（手動で削除が必要）

## 🎉 まとめ

- ✅ 写真撮影ガイドラインを追加
- ✅ 画像に姿勢評価を可視化
- ✅ キーポイントと骨格を表示
- ✅ アライメント線を表示
- ✅ 評価項目とスコアを表示
- ✅ 画像のダウンロード機能

適切な写真を撮影し、詳細な姿勢分析結果を画像で確認できるようになりました！



