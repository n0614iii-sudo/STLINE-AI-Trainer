# 🎯 姿勢タイプ拡張 & 筋肉評価機能

## ✅ 実装完了

姿勢タイプの拡張（立位正面・横向き・背面）と、専門的な筋肉評価機能を追加しました！

## 📊 姿勢タイプの拡張

### 対応姿勢タイプ

1. **立位（正面）** (`standing_front`)
   - 体の正面から撮影
   - 肩の高さ、骨盤の水平度、頭部の位置を評価

2. **立位（横向き）** (`standing_side`)
   - 体の横から撮影
   - 背骨の曲がり、前傾・後傾姿勢を評価

3. **立位（背面）** (`standing_back`)
   - 体の後ろから撮影
   - 肩甲骨の位置、背骨の歪みを評価

4. **座位** (`sitting`)
   - 座った姿勢を評価

5. **歩行中** (`walking`)
   - 歩行中の姿勢を評価

## 💪 筋肉評価機能

### 評価内容

姿勢の問題から、以下の3つの観点で専門的に評価します：

1. **硬い可能性のある筋肉**
   - どの筋肉が硬い可能性があるか
   - 硬くなる理由
   - 深刻度（HIGH/MEDIUM/LOW）

2. **ストレッチが必要な筋肉**
   - どの筋肉を伸ばす必要があるか
   - 具体的なストレッチ方法
   - 推奨頻度

3. **強化が必要な筋肉**
   - どの筋肉を鍛える必要があるか
   - 具体的なエクササイズ方法
   - 推奨頻度

### 評価される筋肉の例

#### 猫背・前傾姿勢の場合

**硬い可能性のある筋肉:**
- 胸鎖乳突筋（きょうさにゅうとつきん）
- 小胸筋（しょうきょうきん）
- 上腕二頭筋（じょうわんにとうきん）

**ストレッチが必要:**
- 胸鎖乳突筋: 首を横に倒し、反対側に回旋させるストレッチ
- 小胸筋: 壁に手をついて胸を開くストレッチ（ドアウェイストレッチ）
- 上腕二頭筋: 壁に手をついて上腕を後方に引くストレッチ

**強化が必要:**
- 深部頸部屈筋（しんぶけいぶくっきん）: チンタック（あごを引く運動）
- 中・下部僧帽筋（ちゅう・かぶそうぼうきん）: 肩甲骨を寄せる運動
- 菱形筋（りょうけいきん）: 肩甲骨を寄せる運動

#### 反り腰の場合

**硬い可能性のある筋肉:**
- 腸腰筋（ちょうようきん）
- 大腿直筋（だいたいちょっきん）
- 腰背部伸筋群（ようはいぶしんきんぐん）

**ストレッチが必要:**
- 腸腰筋: ランジポジションで前脚の股関節を伸ばすストレッチ
- 大腿直筋: 立位で膝を曲げ、かかとをお尻に近づけるストレッチ
- 腰背部伸筋群: 膝を抱えて丸くなるストレッチ

**強化が必要:**
- 腹横筋（ふくおうきん）: ドローイン（お腹を引っ込める運動）
- 骨盤底筋群（こつばんていきんぐん）: ケーゲル運動
- ハムストリングス: ヒップリフト（お尻を持ち上げる運動）

## 📸 診断結果レポート画像

診断結果レポート画像に以下が含まれます：

1. **元の画像**（キーポイント、骨格、アライメント線付き）
2. **総合スコア**
3. **検出された問題**
4. **改善提案**
5. **硬い可能性のある筋肉**（新規追加）
6. **ストレッチが必要な筋肉**（新規追加）
7. **強化が必要な筋肉**（新規追加）

### 画像の構成

```
┌─────────────────────────────────┐
│  元の画像（姿勢評価付き）        │
├─────────────────────────────────┤
│  姿勢診断結果レポート            │
│  ┌───────────────────────────┐ │
│  │ 総合スコア: XX/100        │ │
│  └───────────────────────────┘ │
│                                  │
│  検出された問題                   │
│  ┌───────────────────────────┐ │
│  │ [HIGH] 反り腰の傾向        │ │
│  └───────────────────────────┘ │
│                                  │
│  改善提案                         │
│  ┌───────────────────────────┐ │
│  │ • 腹筋と背筋のバランス    │ │
│  └───────────────────────────┘ │
│                                  │
│  硬い可能性のある筋肉             │
│  ┌───────────────────────────┐ │
│  │ • 腸腰筋                  │ │
│  │   → 骨盤が前傾しているため│ │
│  └───────────────────────────┘ │
│                                  │
│  ストレッチが必要な筋肉           │
│  ┌───────────────────────────┐ │
│  │ • 腸腰筋: ランジポジション│ │
│  │   頻度: 毎日2回           │ │
│  └───────────────────────────┘ │
│                                  │
│  強化が必要な筋肉                 │
│  ┌───────────────────────────┐ │
│  │ • 腹横筋: ドローイン      │ │
│  │   頻度: 毎日2回           │ │
│  └───────────────────────────┘ │
└─────────────────────────────────┘
```

## 🎨 専門的な評価

### 筋肉名の表記

- **日本語名**: 分かりやすい日本語名を使用
- **カタカナ読み**: 専門用語にはカタカナ読みを併記
- **解剖学的正確性**: 正確な筋肉名を使用

### 評価の根拠

各評価は以下の根拠に基づいています：

1. **姿勢の問題**: 検出された姿勢の問題から推測
2. **角度測定**: 関節の角度から筋肉の状態を推測
3. **整列スコア**: 各部位の整列から筋肉の不均衡を推測

### 推奨方法の詳細

- **ストレッチ方法**: 具体的な手順を記載
- **エクササイズ方法**: 具体的な運動方法を記載
- **頻度**: 推奨される実施頻度を記載
- **回数・時間**: 具体的な回数や時間を記載

## 📱 使用方法

### 1. 姿勢タイプの選択

1. 姿勢診断ページにアクセス
2. 「姿勢タイプ」ドロップダウンから選択：
   - 立位（正面）
   - 立位（横向き）
   - 立位（背面）
   - 座位
   - 歩行中

### 2. 診断の実行

1. 選択した姿勢タイプで撮影
2. 「現在の姿勢を分析」をクリック
3. 診断結果が表示されます

### 3. 筋肉評価の確認

診断結果レポート画像に以下が表示されます：

- **硬い可能性のある筋肉**: 問題のある筋肉と理由
- **ストレッチが必要な筋肉**: 具体的なストレッチ方法
- **強化が必要な筋肉**: 具体的なエクササイズ方法

## 🔧 技術詳細

### 筋肉評価のアルゴリズム

```python
def _assess_muscles(issues, angles, alignment_scores, posture_type):
    """
    姿勢の問題から筋肉の状態を評価
    
    - 問題タイプから関連する筋肉を特定
    - 角度測定から筋肉の短縮を推測
    - 整列スコアから筋肉の不均衡を推測
    """
    # 猫背の場合
    if "forward_head_posture" in issue_types:
        # 硬い可能性のある筋肉
        tight_muscles.append("胸鎖乳突筋", "小胸筋", ...)
        # ストレッチが必要
        stretch_needed.append(...)
        # 強化が必要
        strengthen_needed.append(...)
```

### データ構造

```python
muscle_assessment = {
    "tight_muscles": [
        {
            "name": "筋肉名",
            "reason": "硬くなる理由",
            "severity": "high/medium/low"
        }
    ],
    "stretch_needed": [
        {
            "muscle": "筋肉名",
            "method": "ストレッチ方法",
            "frequency": "頻度"
        }
    ],
    "strengthen_needed": [
        {
            "muscle": "筋肉名",
            "exercise": "エクササイズ",
            "frequency": "頻度"
        }
    ]
}
```

## 🎯 改善効果

### Before（以前）

- ❌ 立位正面のみ対応
- ❌ 筋肉の評価なし
- ❌ ストレッチ・強化の具体的な方法なし

### After（現在）

- ✅ 立位正面・横向き・背面に対応
- ✅ 専門的な筋肉評価
- ✅ 具体的なストレッチ・エクササイズ方法
- ✅ 診断結果レポート画像に全ての情報を記載

## 🚀 次のステップ

1. **Railwayで再デプロイ**
   - 変更が自動的にデプロイされます

2. **姿勢タイプを試す**
   - 立位（正面）、立位（横向き）、立位（背面）で診断
   - それぞれの評価結果を確認

3. **筋肉評価を確認**
   - 診断結果レポート画像を確認
   - 硬い可能性のある筋肉を確認
   - ストレッチ・強化の方法を実践

## 🎉 まとめ

- ✅ **姿勢タイプ拡張**: 立位正面・横向き・背面に対応
- ✅ **筋肉評価機能**: 専門的かつ正確な評価
- ✅ **診断結果レポート画像**: 全ての情報を画像に記載
- ✅ **具体的な方法**: ストレッチ・エクササイズの詳細な方法

姿勢診断がより専門的で実用的になりました！💪

